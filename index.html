<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html" charset="utf-8"/>
	<meta id="redirect" http-equiv="Refresh" content="" />
	<title>Söpöysnappi</title>
</head>
<body>
	<p id="text"></p>
	<script>
		const urls = [
			"https://youtu.be/1SfjHEUidAs", // Smiling Dogs Compilation
			"https://youtu.be/CaDLD74ZLhE", // Cute Pomeranian Puppies Doing Funny Things
			"https://youtu.be/nkr6vlTeMWU", // Dog Sliding Down a Snowy Hill
			"https://youtu.be/ZbP-aOwdqvU", // Excited Horse Leaps
			"https://youtu.be/FzJ5Y0CBtRE", // Kitty Begs for Head Boops
			"https://youtu.be/xJVwvq5z3MI", // Ducks Having a Conversation
			"https://youtu.be/lmNXtTZ0G30", // Cat Sledding
			"https://youtu.be/ZvT3a65PalE", // Meerkat resting with a cat
			"https://youtu.be/99k-EAMBuM8", // Duck Run
			"https://www.instagram.com/p/B6OLBpkpdcq/?utm_source=ig_web_copy_link", // Dog running around dad on sofa
			"https://www.instagram.com/p/Bi-G29_AwDK/?utm_source=ig_web_copy_link", // Dog wants to fly
			"https://www.tiktok.com/@angelasversion/video/6876837829473766662" // Dog and a squeaky toy
		];

		const cookie = "asdf=yeet;indices=0;fdsa=eyyt";
		const maxIndices = 3;

		const decodedCk = decodeURIComponent(document.cookie);
		const indicesStr = decodedCk.substring(decodedCk.indexOf("indices=") + 8).split(";")[0].split(",");
		const indices = indicesStr[0] === "" ? [] : indicesStr.map(i => parseInt(i));

		console.log("indices before", indices);

		let index, inIndices;
		do {
			index = Math.floor(Math.random() * urls.length);
			inIndices = indices.indexOf(index) !== -1;
		} while (inIndices);

		const url = urls[index];
		console.log("selected url: " + url);


		indices.push(index);
		while (indices.length > maxIndices) {
			indices.splice(0, 1);
		}

		const date = new Date();
		date.setTime(date.getTime() + 50*24*60*60*1000);
		document.cookie = "indices=" + indices + "; expires=" + date.toUTCString() + "; SameSite=Lax; path=/";

		console.log(document.cookie);

		console.log("expires=" + date.toUTCString());


		function clearCookie() {
			const date0 = new Date();
			date0.setTime(0);
			document.cookie="indices=; expires=" + date0.toUTCString() + "; SameSite=Lax; path=/";
		}

		// document.getElementById("redirect").content = "0; url='" + url + "'";
		document.getElementById("text").innerText = url;
	</script>
</body>
</html>
